<h1 id="hux-blog-i-classfa-fa-twitter-fa-lgi">Hux Blog <i class="fa fa-twitter fa-lg"></i></h1>

<h3 id="view-live-hux-bloghttphuxprogithubio"><a href="http://huxpro.github.io">View Live Hux Blog</a></h3>

<p><img src="/img/appt1656.jpg" alt="" /></p>

<h3 id="page-build-warning-email">“Page Build Warning” email</h3>

<p>These days, some of you must receive a “Page Build Warning” email from github after you commit happily. <strong>Don’t Worried!</strong> It just that github changes its build environment.
 <a href="http://huxpro.github.io">View Live Hux Blog</a></p>

<p>In this mail, github told us:</p>

<blockquote>
  <p>You are attempting to use the ‘pygments’ highlighter, which is currently unsupported on GitHub Pages. Your site will use ‘rouge’ for highlighting instead. To suppress this warning, change the ‘highlighter’ value to ‘rouge’ in your ‘_config.yml’.</p>
</blockquote>

<p>So, just edit <code class="highlighter-rouge">_config.yml</code>, find <code class="highlighter-rouge">highlighter: pygments</code>, change it to <code class="highlighter-rouge">highlighter: rouge</code> and the warning will be gone.</p>

<h2 id="boilerplate-beta">Boilerplate (beta)</h2>

<p>Want to clone a boilerplate instead of my buzz blog? Here comes this!</p>

<h3 id="post-test">Post Test</h3>

<p>上周末巴萨在主场表现出了强大的控制力，凭借华丽的进攻6-0大胜赫塔菲。其实在那场比赛中，恩里克便已经考虑到了周中与阿森纳的较量，并做了充足的备战，他让球队丢掉了“挨打-反击”战术，从一开场便抢夺比赛的控制权，通过潮水般的攻势和成功的高位防守吃掉了对手。此役面对阿森纳，巴萨一开场便表明了以我为主、主动出击的态度，如果阿森纳一味防守，那一场一边倒的大屠杀将在所难免。</p>

<hr />

<p><code class="highlighter-rouge">python
from datetime import datetime
from __future__ import division
import pandas as pd    
from pandas import Series,DataFrame
from pandas.io.data import DataReader
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
sns.set_style('whitegrid')
%matplotlib inline
</code></p>

<p><code class="highlighter-rouge">python
end = datetime.now()
start = datetime(end.year - 1,end.month,end.day)
s = DataReader("BABA",'yahoo',start,end)
#s.ix['2015-12-24']
s.head()
</code></p>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Open</th>
      <th>High</th>
      <th>Low</th>
      <th>Close</th>
      <th>Volume</th>
      <th>Adj Close</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-05</th>
      <td>102.760002</td>
      <td>103.019997</td>
      <td>99.900002</td>
      <td>101.000000</td>
      <td>18337000</td>
      <td>101.000000</td>
    </tr>
    <tr>
      <th>2015-01-06</th>
      <td>101.250000</td>
      <td>103.849998</td>
      <td>100.110001</td>
      <td>103.320000</td>
      <td>15720400</td>
      <td>103.320000</td>
    </tr>
    <tr>
      <th>2015-01-07</th>
      <td>104.589996</td>
      <td>104.739998</td>
      <td>102.029999</td>
      <td>102.129997</td>
      <td>11052200</td>
      <td>102.129997</td>
    </tr>
    <tr>
      <th>2015-01-08</th>
      <td>102.949997</td>
      <td>105.339996</td>
      <td>102.680000</td>
      <td>105.029999</td>
      <td>12942100</td>
      <td>105.029999</td>
    </tr>
    <tr>
      <th>2015-01-09</th>
      <td>105.239998</td>
      <td>105.300003</td>
      <td>102.889999</td>
      <td>103.019997</td>
      <td>10222200</td>
      <td>103.019997</td>
    </tr>
  </tbody>
</table>
</div>

<p><code class="highlighter-rouge">python
s['Adj Close'].plot(legend=True,figsize=(10,4))
</code></p>

<p><img src="/assets/image/output_2_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
s['Volume'].plot(legend=True,figsize=(10,4))
</code></p>

<p><img src="/assets/image/output_3_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
ma_day = [10,20,40]
for ma in ma_day:
    column = "MA for %s days" %(str(ma))
    s[column] = pd.rolling_mean(s['Adj Close'],ma)
s[['Adj Close','MA for 10 days','MA for 20 days','MA for 40 days']].plot(subplots=False,figsize=(10,4))
</code></p>

<p><img src="/assets/image/output_4_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
s['Daily Return']=s['Adj Close'].pct_change()
# print s['Daily Return']
s['Daily Return'].dropna().plot(figsize=(10,4),legend=True,linestyle='--',marker='s')
print s['Daily Return'].mean()
print s['Daily Return'].std()
</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>-0.000642374946063
0.0213393676909
</code></pre>
</div>

<p><img src="/assets/image/output_5_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
sns.plt.xlim(-0.1,0.1)
sns.distplot(s['Daily Return'].dropna(),color='0.2',bins=40,
             kde_kws={"color": sns.xkcd_rgb["pale red"], "lw": 3, 
             "bw": 0.2,"alpha": .8})
# sns.kdeplot(s['Daily Return'].dropna())
</code></p>

<p><img src="/assets/image/output_6_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
close_df = DataReader(['BABA','EBAY','AMZN','PYPL'],'yahoo',start,end)['Adj Close']
close_df['AMZN'].plot()
</code></p>

<p><img src="/assets/image/output_7_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
pct_df = close_df.pct_change()
sns.jointplot('EBAY','PYPL',pct_df,kind='scatter',joint_kws={'alpha':0.6})
</code></p>

<p><img src="/assets/image/output_8_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
sns.pairplot(pct_df.dropna())
</code></p>

<p><img src="/assets/image/output_9_1.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
close_df1 = DataReader(['BABA','EBAY','AMZN','YHOO','WMT'],'yahoo',start,end)['Adj Close']
pct_df1 = close_df1.pct_change()
with sns.axes_style('darkgrid'):
    fig, ax = plt.subplots(figsize=(6, 6))
    sns.corrplot(pct_df1.dropna(),annot=True,
                 cmap=sns.diverging_palette(230, 20,sep=50, 
                 n=7,as_cmap=True))   
</code></p>

<p><img src="/assets/image/output_10_0.png" alt="png" /></p>

<p>```python
risk_df = pct_df1</p>

<p>plt.ylim([0.01,0.028])
plt.xlim([-0.005,0.01])
plt.xlabel(‘Expected returns’)
plt.ylabel(‘Risk’)</p>

<p>plt.scatter(risk_df.mean(),risk_df.std(),alpha=0.5,
            s=close_df1.dropna().mean(),label=’Average Adj Close’)
plt.legend(loc=1)</p>

<p>for label, x, y in zip(risk_df.columns, risk_df.mean(), risk_df.std()):
    plt.annotate(
        label, 
        xy = (x, y), xytext = (30, 10),
        textcoords = ‘offset points’, ha = ‘left’, va = ‘bottom’,
        bbox = dict(boxstyle = ‘round,pad=0.3’, fc = ‘yellow’, alpha = .5),
        arrowprops = dict(arrowstyle = ‘-‘, connectionstyle = ‘arc3,
        rad=-0.1’))
```</p>

<p><img src="/assets/image/output_11_0.png" alt="png" /></p>

<p><code class="highlighter-rouge">python
risk_df['BABA'].quantile(0.05)
</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>-0.032540597138561403
</code></pre>
</div>

<p>```python
days = 365
dt = 1/days
mu = risk_df.mean()[‘BABA’] # drift of expected return
sigma = risk_df.std()[‘BABA’] # volatility of stock</p>

<p>def stock_monte_carlo(start_price,days,mu,sigma):
    price = np.zeros(days)
    price[0] = start_price
    shock = np.zeros(days)
    drift = np.zeros(days)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>for x in xrange(1,days):
    shock[x] = np.random.normal(loc=mu * dt, scale=sigma * np.sqrt(dt))
    drift[x] = mu * dt
    price[x] = price[x-1] + (price[x-1] * (drift[x] + shock[x]))
return price
</code></pre>
</div>

<p>start_price = 103.94</p>

<p>for run in xrange(100):
    plt.plot(stock_monte_carlo(start_price,days,mu,sigma))</p>

<h1 id="pltplotsadj-close">plt.plot(s[‘Adj Close’])</h1>
<p>plt.xlabel(“Days”)
plt.ylabel(“Price”)
plt.title(‘Alibaba based on Monte Carlo Simulation’)
```</p>

<p><img src="/assets/image/output_13_1.png" alt="png" /></p>

<p>```python
# Set a large numebr of runs
runs = 10000</p>

<h1 id="create-an-empty-matrix-to-hold-the-end-price-data">Create an empty matrix to hold the end price data</h1>
<p>simulations = np.zeros(runs)</p>

<h1 id="set-the-print-options-of-numpy-to-only-display-0-5-points-from-an-array-to-suppress-output">Set the print options of numpy to only display 0-5 points from an array to suppress output</h1>
<p>np.set_printoptions(threshold=5)</p>

<p>for run in xrange(runs):  <br />
    # Set the simulation data point as the last stock price for that run
    simulations[run] = stock_monte_carlo(start_price,days,mu,sigma)[days-1];
```</p>

<p>```python
# Now we’lll define q as the 1% empirical qunatile, this basically means that 99% of the values should fall between here
q = np.percentile(simulations, 1)</p>

<h1 id="now-lets-plot-the-distribution-of-the-end-prices">Now let’s plot the distribution of the end prices</h1>
<p>plt.hist(simulations,bins=200)</p>

<h1 id="using-pltfigtext-to-fill-in-some-additional-information-onto-the-plot">Using plt.figtext to fill in some additional information onto the plot</h1>

<h1 id="starting-price">Starting Price</h1>
<p>plt.figtext(0.65, 0.8, “Start price: $%.2f” %start_price)
# Mean ending price
plt.figtext(0.65, 0.7, “Mean final: $%.2f” % simulations.mean())</p>

<h1 id="variance-of-the-price-within-99-confidence-interval">Variance of the price (within 99% confidence interval)</h1>
<p>plt.figtext(0.65, 0.6, “VaR(0.99): $%.2f” % (start_price - q,), color=’.4’)</p>

<h1 id="display-1-quantile">Display 1% quantile</h1>
<p>plt.figtext(0.65, 0.5, “q(0.99): $%.2f” % q, color=sns.xkcd_rgb[“pale red”])</p>

<h1 id="plot-a-line-at-the-1-quantile-result">Plot a line at the 1% quantile result</h1>
<p>plt.axvline(x=q, linewidth=3,color=sns.xkcd_rgb[“pale red”],alpha=.8)
plt.axvline(x=start_price, linewidth=3,color=’.6’,alpha=.6)</p>

<h1 id="title">Title</h1>
<p>plt.title(u”Final price distribution for Alibaba Stock after %s days” % days, weight=’bold’);
```</p>

<p><img src="/assets/image/output_15_0.png" alt="png" /></p>

